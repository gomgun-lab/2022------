# 2022 겨울 계절학기 개별연구

1. [계획](#계획)
2. [수집 데이터](#수집-데이터)
3. [그래프 생성](#그래프-생성)
4. [알고리즘 설계 및 구현](#알고리즘-설계-및-구현)
5. [성능 분석](#성능-분석)
6. [구현 결과](#구현-결과)
   
# 계획

본 개별 연구의 전체적인 연구 계획은 다음과 같다. 우선 서울시의 지하철 노선 정보를 수집하여 연구에서 사용할 노선도 그래프 데이터를 생성한다. 이후 약속 장소 추천 및 길 안내 알고리즘을 설계 후 구현까지 진행한다. 마지막으로, 미리 전처리하여 생성한 그래프 데이터를 사용해 알고리즘을 수행한 간단한 웹 애플리케이션을 구현한다. 그래프 생성, 알고리즘 및 애플리케이션 구현에는 typescript와 javascript 프로그래밍 언어를 사용하며, react 프레임워크를 이용하여 데모 애플리케이션을 제작한다.

# 수집 데이터

서울 열린 데이터 광장의 공공데이터를 사용하여 연구를 진행한다. 데이터 속 “외부 코드”의 할당방식의 문제를 발견하여 다음 링크인 [“서울교통공사 노선별 지하철역 정보”](https://data.seoul.go.kr/dataList/OA-15442/S/1/datasetView.do)에서 제공받은 데이터 중 서울시의 1~8호선 지하철역의 일정 부분에 대해서만 한정해서 연구를 진행한다.

# 그래프 생성

서울 열린 데이터 광장에서 제공하는 “서울교통공사 노선별 지하철역 정보”의 데이터 세부 정보는 다음과 같다.

```json
{
   "DESCRIPTION":{
      "STATION_NM":"전철역명",
      "STATION_CD":"전철역코드",
      "STATION_NM_CHN":"전철명명(중문)",
      "LINE_NUM":"호선",
      "FR_CODE":"외부코드",
      "STATION_NM_JPN":"전철명명(일문)",
      "STATION_NM_ENG":"전철명명(영문)"
   },
   "DATA":[
      {
         "line_num":"02호선",
         "station_nm_chn":"龍踏",
         "station_cd":"0244",
         "station_nm_jpn":"龍踏",
         "station_nm_eng":"Yongdap",
         "station_nm":"용답",
         "fr_code":"211-1"
      },
      ... 생략
   ]
}	
```

이 중, 수집한 데이터는 전철 역명, 호선, 외부 코드이다. 전철 역명, 호선은 전철역의 한글 이름, 개통 호선을 의미하며 외부 코드는 각 지하철별 고유한 코드로 전철역 코드와 같은 역할을 가지나 각 지하철역의 연결 정보를 추가적으로 유추할 수 있다. 일반적으로 알려진 그래프의 데이터 형태는 리스트나, 2차원 배열이다. 본 연구에서는 리스트 형태와 유사한 주변 역의 정보를 value 값으로 저장하는 해시 테이블 자료구조를 이용해서 각 객체의 참조 속성을 통해 지하철역의 연결 정보를 생성한다. 그러기 위해서는 서울시에서 제공받은 데이터의 외부 코드(fr_code) 속성값이 필요하다. 외부 코드 정보를 통해 이전 지하철역, 다음 지하철역의 정보를 참조할 수 있다. 실제 1호선의 시작역인 소요산역의 외부 코드 값은 100이며 그다음 역인 동두천역의 외부 코드 값은 101이다. 이전 역, 다음 역이라는 단어를 사용하였는데 이는 지하철의 진행 방향에 따라 달라질 수 있으므로 이와 같이 순서를 구분하는 것은 의미가 없다. 따라서, 단순히 연결 정보만 자료구조에 저장하였다.

## 전처리 과정

그래프를 생성하기에 총 2단계를 거친다. 처음 서울시로부터 제공받은 데이터를 전처리하는 과정과 전처리한 데이터를 통해 그래프를 생성하는 단계이다. 전처리를 하는 이유는 외부 코드 정보를 할당하는 방식에 있어서 본 연구를 진행하기에 문제가 발견되었기 때문이다. 일반적인 경우에는 올바른 값을 가지고 있으나 다른 호선으로 환승 혹은 같은 호선이지만 분리되어 다른 가지로 뻗어나가는 경우에 외부 코드를 할당하는 방식이 통일되어 있지 않았다. 용이한 외부 코드들만 사용하는 방식을 채택하였다. 
예시로 구로역에서 분기가 새로 가산 디지털단지역으로 환승하였을 때 구로역의 외부 코드는 141이며 가산디지털단지역의 외부 코드는 P142이다. 금천구청의 외부 코드는 P144이며 이 역으로부터 분기가 생성되는 첫 역인 광명역의 외부 코드는 P144-1이다. 앞서 구로역과 가산디지털단지역에서의 외부 코드의 차이에는 분기 생성 시, 핵심 부분의 3자리 정수의 값이 바뀌었지만 금천구청 역에서 광명역으로의 분기에는 핵심 부분의 3자리 정숫값이 동일하다. 이처럼 동일한 호선에서 노선이 분기되어 생성될 때 외부 코드를 부여하는 방식이 통일되지 않는 모습을 띄고 있다. 따라서 이 문제를 해결하기 위해 데이터의 전처리 작업이 필요하다.

<p align="center">
    <img src="https://github.com/gomgun-lab/2022-winter-semester/assets/64501757/f17f0202-563c-4f5d-8380-23325e39ee4c">
</p>

외부 코드는 다음과 같이 총 4가지 타입으로 나누어진다.

1.	3자리 정수 (346, 428, …)
2.	3자리 정수에 맨 앞자리로 알파벳 대문자가 더해진 값 (K111, P177, …)
3.	3자리 정수에 “-“기호와 정수가 더해진 값 (211-1, 211-2, …)
4.	2, 3번 타입이 합쳐진 값 (K111-1, P144-1)

외부 코드는 데이터 자체에서 부여되어서 생성되기 때문에 본 연구에서 외부 코드값을 직접 변경해 줄 순 없다. 따라서 외부 코드에 직접영향을 가하는 작업 대신에 기존의 외부 코드에 이상이 생기는 부분을 제거하여 전처리 작업을 수행한다. 앞서 설명한 것처럼 외부 코드의 종류가 달라지는 부분은 지하철 노선이 분기될 때이므로 그래프를 생성할 때 분기되는 경우를 제거하고 생성한다. 4가지 타입의 외부 코드 중 1번 타입만 사용하면 모든 분기 처리가 제거된 그래프를 사용할 수 있다. 
전처리 과정의 진행 순서는 다음과 같다.

1.	서울시 모든 호선에 대한 해시테이블을 생성하여 이용 가능한 호선은 true 값을 부여
2.	노선도 데이터의 호선 정보와 해시테이블에서의 이용 가능한 호선 정보를 비교해서 각 호선별로 지하철역을 필터링하여 생성
3.	외부 코드 1번 타입에 대응되는 스트링 매칭을 사용하여 분기 제거
4.	추가적으로 그래프 생성 시 편의를 위해서 외부 코드를 기준으로 데이터 정렬

위 과정을 통해 생성된 데이터는 다음과 같다.

```json
{
   "03호선":[
      {
         "line_num":"03호선",
         "station_nm":"대화",
         "fr_code":"309"
      },
      "..."
   ],
   "04호선":[
      {
         "line_num":"04호선",
         "station_nm":"진접",
         "fr_code":"405"
      },
      "..."
   ],
	. . . 이외 호선 정보
}
```

## 그래프 생성 과정

앞서 데이터 전처리 과정을 통해 연구에서 사용할 호선별 지하철역의 목록을 생성하였다. 이후 해당 데이터를 통해 알고리즘에서 사용이 용이한 그래프를 생성하면 최종적으로 그래프 생성 단계는 마무리된다.
이전의 전처리 데이터를 그래프의 형태로 가공해 주는 작업을 이번 단계에서 수행한다. 먼저 각 호선의 지하철역들을 순회하면서 지하철역 리스트를 생성한다. 이전 단계에서 외부 코드를 기준으로 지하철역들을 정렬해 두었으므로 정렬된 지하철역의 외부코드 – 1에 해당하는 역, 외부코드 + 1에 해당하는 역을 모아 주변 노드로 설정한다. 시작역과, 종점역의 구분은 정렬된 값들이 배열 타입이므로 배열의 index를 통해 확인하다.
1호선부터 8호선까지 순회하면서 해당하는 지하철역의 이름을 key 값으로 현재 외부 코드 -1, +1 값에 해당하는 역들의 정보는 테이블의 value 값으로 설정하여 연결한다. 만약 호선은 다른데 동일한 지하철역명이 존재한다면 환승역을 의미하므로 동일한 방법으로 외부 코드를 통해 노드 정보를 추가 해주어 생성 가능하다. 최종적으로 생성된 그래프의 형태는 아래와 같다.

```json
{
   "신흥":[
      {
         "line_num":"08호선",
         "station_nm":"단대오거리",
         "fr_code":"824"
      },
      {
         "line_num":"08호선",
         "station_nm":"수진",
         "fr_code":"826"
      }
   ],
   "수진":[
      {
         "line_num":"08호선",
         "station_nm":"신흥",
         "fr_code":"825"
      },
      {
         "line_num":"08호선",
         "station_nm":"모란",
         "fr_code":"827"
      }
   ],
   "모란":[
      {
         "line_num":"08호선",
         "station_nm":"수진",
         "fr_code":"826"
      }
   ],
	... 이외 지하철역 정보
}
```

# 알고리즘 설계 및 구현

알고리즘은 총 두 가지를 설계하였다. 약속 장소를 설정하기 위해 모든 인원들로부터 동일한 거리의 좌표를 계산하는 알고리즘과, 해당 좌표와 가까운 지하철역부터 각 유저 주변의 지하철역까지 길 찾기를 수행하는 알고리즘이다.

## 동일한 거리의 좌표 계산 알고리즘

지도상의 N 개의 점으로부터 동일한 거리에 있는 새로운 점의 좌표를 생성하는 알고리즘이다. 입력으로는 위도와 경도 값을 담고 있는 객체의 배열을 받아. 생성된 점의 위도, 경도 값을 가진 객체를 반환한다. 계산 과정은 단순히 모든 점들의 위도, 경도 값을 각각 더하여 점의 개수로 나눈다.

## 길찾기 알고리즘

길 찾기 알고리즘은 이전 동일한 거리의 좌표 계산 알고리즘으로부터 생성한 좌표를 종점으로 설정하고 N 개의 시작점으로부터 각각 최적의 경로를 찾는 알고리즘이다. 즉, N 개 유저의 입력 좌표 주변의 역을 찾아 출발지로 설정하고, 목적지 좌표와 가장 가까운 역을 도착지로 설정하여 그래프 탐색을 수행한다. 출력 결과는 출발역, 종착역 사이의 역들의 배열을 반환한다. 기본 탐색 알고리즘은 다익스트라 알고리즘을 기반으로 설계하였다.

# 성능 분석

현재 상용 길 찾기 알고리즘의 분석 결과 기본적인 길 찾기 알고리즘으로 다익스트라 알고리즘을 채택하였다. 여기서 각 노드별 가중치를 조절해 주는 차이가 존재했지만, 기본적으로 다익스트라 알고리즘을 사용한다. 길 찾기 알고리즘인 다익스트라 알고리즘의 시간 복잡도는 우선순위 큐를 사용하는 경우 O(ElogV)이다. E는 간선의 개수, V는 노드의 개수를 의미한다. 다익스트라 알고리즘은 이미 알려진 충분히 성능이 보장된 알고리즘이므로 알고리즘 자체를 수정하기보다는 다익스트라 알고리즘 자체가 얼마나 수행되는지를 중점을 두고 과제를 진행하였다. 

동일한 거리 좌표 계산 알고리즘은 N 개의 입력에 대한 단일 반복을 하므로 총 시간 복잡도는 O(N)이다. 이후 N번의 다익스트라 알고리즘을 수행하므로 O(NElogV)의 시간 복잡도를 가진다. 따라서 길찾기 알고리즘의 총 시간 복잡도는 O(NElogV)수준을 보인다.

# 구현 결과

React, typescript와 kakao api를 이용하여 애플리케이션을 구현하였다. 처음 애플리케이션 실행 시, 출발지 정보를 입력할 수 있으며 장소 추가하기 버튼을 클릭하여 출발지를 추가할 수 있다.

<p align="center">
  <img src="https://github.com/gomgun-lab/2022-winter-semester/assets/64501757/da2a1456-7d1b-4762-83ed-56fb1c4202ac">
</p>

리스트의 아이템을 클릭하면 출발지를 입력할 수 있는 페이지로 이동한다. 서울시의 지역 정보를 입력하면 kakao api로 해당 입력 값을 호출해 검색 결과를 리스트로 호출한다. 

<p align="center">
  <img src="https://github.com/gomgun-lab/2022-winter-semester/assets/64501757/29e66497-1a7a-4a10-9663-d39f1099127c">
</p>

검색 리스트 중 원하는 값을 선택하여 시작 주소를 설정할 수 있다. 리스트의 회색 버튼이 현재 마우스가 올라가 있는 상태이며 이 상태에서 클릭 시 값이 설정된 후, 메인 페이지로 다시 돌아간다.

<p align="center">
  <img src="https://github.com/gomgun-lab/2022-winter-semester/assets/64501757/c481a081-f1c6-467a-9594-9d12bdd33300">
</p>

시작 위치를 설정한 후 중간 장소 찾기 버튼을 클릭하면 [Figure 13]과 같은 결과가 출력되며 지도와 N 개의 입력에 대한 경로를 표시한다. 파란색 마커는 도착 지점을, 빨간색 마커는 시작 지점을 의미하며 하단의 카드에서 각 입력별 경로를 보여준다. 처음 역은 시작 역이며 리스트의 마지막 역은 도착열을 의미한다.

<p align="center">
  <img src="https://github.com/gomgun-lab/2022-winter-semester/assets/64501757/31f49424-782a-427a-8088-3e079d1d8b42">
</p>



